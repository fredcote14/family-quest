<!DOCTYPE html>
<html lang="fr-CA">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <title>QG Famille C√¥t√©</title>
    <link href="https://fonts.googleapis.com/css2?family=Exo+2:wght@400;700&family=Rajdhani:wght@500;700&display=swap" rel="stylesheet">
    <script src="https://cdn.jsdelivr.net/npm/canvas-confetti@1.6.0/dist/confetti.browser.min.js"></script>
    <style>
        :root { --bg-deep:#050a14; --bg-light:#0f1c2e; --accent-cyan:#00f2ff; --accent-gold:#ffb700; --accent-green:#00ff9d; --accent-red:#ff0055; --text-main:#ffffff; --text-dim:#8b9bb4; }
        body { font-family:'Exo 2',sans-serif; background:linear-gradient(135deg,var(--bg-deep) 0%,#1a2639 100%); color:var(--text-main); margin:0; padding:0; min-height:100vh; overflow-x:hidden; -webkit-tap-highlight-color:transparent; }
        .container { max-width:1000px; margin:0 auto; padding:20px 20px 80px 20px; }
        
        /* LOGIN SCREEN */
        #loginScreen { position:fixed; top:0; left:0; width:100%; height:100%; background:var(--bg-deep); z-index:5000; display:flex; flex-direction:column; justify-content:center; align-items:center; }
        .profile-grid { display:grid; grid-template-columns:repeat(2,1fr); gap:20px; max-width:400px; width:100%; padding:20px; }
        .profile-card { background:var(--bg-light); border:1px solid rgba(255,255,255,0.1); border-radius:15px; padding:20px; text-align:center; cursor:pointer; transition:0.2s; }
        .profile-card:hover { transform:scale(1.05); border-color:var(--accent-cyan); box-shadow:0 0 15px rgba(0,242,255,0.2); }
        .avatar-circle { width:80px; height:80px; border-radius:50%; margin:0 auto 10px auto; display:flex; align-items:center; justify-content:center; font-size:2rem; font-weight:bold; color:black; border:2px solid white; }
        .profile-name { font-family:'Rajdhani'; font-size:1.2rem; font-weight:bold; margin-top:10px;}

        /* UI ELEMENTS */
        .glass-panel { background:rgba(15,28,46,0.7); backdrop-filter:blur(12px); border:1px solid rgba(255,255,255,0.08); border-radius:20px; padding:20px; margin-bottom:20px; box-shadow:0 10px 30px rgba(0,0,0,0.3); }
        .top-bar { display:flex; justify-content:space-between; align-items:center; margin-bottom:20px; }
        .current-user-pill { background:rgba(0,242,255,0.1); padding:8px 20px; border-radius:30px; border:1px solid var(--accent-cyan); font-weight:bold; cursor:pointer; display:flex; align-items:center; gap:10px; }
        
        /* DASHBOARD */
        .dashboard { display:grid; grid-template-columns:1fr; gap:20px; }
        @media (min-width:768px) { .dashboard { grid-template-columns:2fr 1fr; } }
        
        /* CARDS */
        .quest-card { background:linear-gradient(90deg,rgba(255,255,255,0.03) 0%,transparent 100%); border-left:4px solid var(--text-dim); padding:15px; margin-bottom:10px; border-radius:0 10px 10px 0; display:flex; justify-content:space-between; align-items:center; }
        .btn { background:transparent; border:1px solid var(--accent-cyan); color:var(--accent-cyan); padding:8px 12px; border-radius:6px; font-weight:bold; text-transform:uppercase; font-size:0.8rem; cursor:pointer; }
        .btn-approve { border-color:var(--accent-green); color:var(--accent-green); }
        .shop-grid { display:grid; grid-template-columns:repeat(auto-fill,minmax(100px,1fr)); gap:10px; }
        .shop-item { background:rgba(0,0,0,0.2); border:1px solid rgba(255,255,255,0.1); padding:10px; text-align:center; border-radius:10px; }
        input, select { width:100%; padding:12px; margin:5px 0; background:#091220; border:1px solid #2a3b55; color:white; border-radius:8px; }
        
        /* LOADING & POPUP */
        #loadingOverlay { position:fixed; top:0; left:0; width:100%; height:100%; background:var(--bg-deep); z-index:7000; display:flex; justify-content:center; align-items:center; color:var(--accent-cyan); }
        #successPopup { position: fixed; top: 50%; left: 50%; transform: translate(-50%, -50%); background: rgba(5, 10, 20, 0.95); border: 3px solid var(--accent-gold); padding: 40px; border-radius: 20px; text-align: center; z-index: 3000; display: none; min-width: 250px; }
        #successPopup h1 { margin: 0; color: var(--accent-gold); font-family: 'Rajdhani'; }
    </style>
</head>
<body>

<div id="loadingOverlay">CHARGEMENT...</div>
<div id="successPopup"><h1>SUCC√àS !</h1></div>

<div id="loginScreen">
    <h1 style="font-family:'Rajdhani'; letter-spacing:2px; color:var(--accent-cyan); margin-bottom:30px;">QUI √äTES-VOUS ?</h1>
    <div class="profile-grid">
        <div class="profile-card" onclick="login('Olivier')">
            <div class="avatar-circle" style="background:#00f2ff;">O</div>
            <div class="profile-name">Olivier</div>
        </div>
        <div class="profile-card" onclick="login('Alexis')">
            <div class="avatar-circle" style="background:#00ff9d;">A</div>
            <div class="profile-name">Alexis</div>
        </div>
        <div class="profile-card" onclick="login('Fred')">
            <div class="avatar-circle" style="background:#ffb700;">F</div>
            <div class="profile-name">Fred (Admin)</div>
        </div>
        <div class="profile-card" onclick="login('Karine')">
            <div class="avatar-circle" style="background:#ff0055;">K</div>
            <div class="profile-name">Karine (Admin)</div>
        </div>
    </div>
</div>

<div class="container" id="mainApp" style="display:none;">
    <div class="top-bar">
        <div class="current-user-pill" onclick="logout()">
            <span id="headerName">Utilisateur</span>
            <small style="opacity:0.7; margin-left:10px">‚èª</small>
        </div>
        <div style="text-align:right">
            <div style="color:var(--accent-gold); font-weight:bold; font-size:1.2rem"><span id="headerGold">0</span> $ OR</div>
            <div style="font-size:0.8rem; color:var(--text-dim)">Niveau <span id="headerLevel">1</span></div>
        </div>
    </div>

    <div class="dashboard">
        <div>
            <div class="glass-panel">
                <h2 style="margin-top:0; color:var(--accent-cyan)">‚öîÔ∏è Missions</h2>
                <div id="questList"></div>
            </div>

            <div id="adminPanel" class="glass-panel" style="display:none; border-color:var(--accent-green)">
                <h3 style="margin-top:0; color:var(--accent-green)">+ AJOUTER MISSION</h3>
                <select id="taskPreset" onchange="applyPreset()">
                    <option value="">-- Mod√®les Rapides --</option>
                    <option value="dish">üçΩÔ∏è Vider lave-vaisselle (15 G)</option>
                    <option value="trash">üóëÔ∏è Sortir poubelles (10 G)</option>
                    <option value="room">üõèÔ∏è M√©nage chambre (50 G)</option>
                    <option value="snow">‚ùÑÔ∏è Pelleter l'entr√©e (100 G)</option>
                    <option value="gear">üèí √âquipement hockey (25 G)</option>
                    <option value="laundry">üëï Plier lavage (30 G)</option>
                </select>
                <div style="display:flex; gap:10px;">
                    <input type="text" id="newTaskName" placeholder="Titre...">
                    <input type="number" id="newTaskGold" placeholder="$" style="width:80px">
                </div>
                <select id="newTaskAssignee">
                    <option value="Olivier">Pour : Olivier</option>
                    <option value="Alexis">Pour : Alexis</option>
                </select>
                <button class="btn" style="width:100%; margin-top:10px; background:var(--accent-green); color:black" onclick="addTask()">LANCER</button>
            </div>
        </div>

        <div>
            <div class="glass-panel">
                <h2 style="margin-top:0; color:var(--accent-gold)">üõí Boutique</h2>
                <div class="shop-grid">
                    <div class="shop-item"><b>1h Jeux</b><br><span style="color:gold">50 $</span><br><button class="btn" style="margin-top:5px" onclick="buyItem(50,'1h Jeux')">ACHETER</button></div>
                    <div class="shop-item"><b>Sauter T√¢che</b><br><span style="color:gold">200 $</span><br><button class="btn" style="margin-top:5px" onclick="buyItem(200,'Passe-Droit')">ACHETER</button></div>
                    <div class="shop-item"><b>5$ Argent</b><br><span style="color:gold">500 $</span><br><button class="btn" style="margin-top:5px" onclick="buyItem(500,'5$ Argent')">ACHETER</button></div>
                    <div class="shop-item"><b>Choix Souper</b><br><span style="color:gold">1000 $</span><br><button class="btn" style="margin-top:5px" onclick="buyItem(1000,'Choix Souper')">ACHETER</button></div>
                </div>
            </div>
        </div>
    </div>
</div>

<script>
    // ********************************************
    // ZONE DE CONFIGURATION
    // ********************************************
    
    // COLLEZ VOTRE LIEN GOOGLE SCRIPT ICI :
    const API_URL = "PASTE_YOUR_URL_HERE"; 

    // CODE PIN POUR LES PARENTS
    const PARENT_PIN = "1234";

    const PRESETS = {
        "dish": { title: "Vider le lave-vaisselle", gold: 15 },
        "trash": { title: "Sortir les poubelles", gold: 10 },
        "room": { title: "M√©nage de la chambre", gold: 50 },
        "snow": { title: "Pelleter l'entr√©e", gold: 100 },
        "gear": { title: "Ranger l'√©quipement hockey", gold: 25 },
        "laundry": { title: "Plier le lavage", gold: 30 }
    };

    // ********************************************

    let appData = { tasks: [], users: { "Olivier": {gold:0, xp:0}, "Alexis": {gold:0, xp:0}, "Fred": {gold:0, xp:0}, "Karine": {gold:0, xp:0} } };
    let currentUser = null;
    let isAdmin = false;

    async function init() {
        if(API_URL.includes("PASTE_YOUR")) { alert("URL MANQUANTE !"); return; }
        try {
            const res = await fetch(API_URL);
            const data = await res.json();
            if(data && data.users) appData = data;
        } catch(e) { console.log("Mode Hors Ligne"); }
        document.getElementById('loadingOverlay').style.display = 'none';
    }

    function login(name) {
        // V√âRIFICATION DU PIN POUR LES PARENTS
        if (name === "Fred" || name === "Karine") {
            const code = prompt("Entrez le Code NIP Parent :");
            if (code !== PARENT_PIN) {
                alert("Code incorrect ! Acc√®s refus√©.");
                return;
            }
            isAdmin = true;
        } else {
            isAdmin = false;
        }

        currentUser = name;
        document.getElementById('loginScreen').style.display = 'none';
        document.getElementById('mainApp').style.display = 'block';
        document.getElementById('headerName').innerText = currentUser;
        renderDashboard();
    }

    function logout() {
        currentUser = null;
        isAdmin = false;
        document.getElementById('mainApp').style.display = 'none';
        document.getElementById('loginScreen').style.display = 'flex';
    }

    function renderDashboard() {
        // Stats
        if(!isAdmin) {
            const u = appData.users[currentUser] || {gold:0, xp:0};
            document.getElementById('headerGold').innerText = u.gold;
            document.getElementById('headerLevel').innerText = Math.floor(u.xp / 100) + 1;
        } else {
            document.getElementById('headerGold').innerText = "-";
            document.getElementById('headerLevel').innerText = "ADMIN";
        }

        // Admin Panel Visibility
        document.getElementById('adminPanel').style.display = isAdmin ? 'block' : 'none';

        // Tasks List
        const list = document.getElementById('questList');
        list.innerHTML = '';
        
        if(appData.tasks.length === 0) list.innerHTML = `<div style="text-align:center; opacity:0.5; padding:20px">Aucune mission en cours</div>`;

        appData.tasks.forEach(task => {
            if(task.status === 'done') return;
            
            let badgeColor="#555"; let statusText="En Attente"; let actionBtn="";

            if(task.status === 'review') {
                badgeColor="var(--accent-cyan)"; statusText="V√©rification...";
                if(isAdmin) actionBtn = `<button class="btn btn-approve" onclick="approveTask(${task.id})">‚úî Valider</button>`;
                else actionBtn = `<small style="color:var(--accent-cyan)">Attente validation</small>`;
            } else {
                if(currentUser === task.assignee) actionBtn = `<button class="btn" onclick="completeTask(${task.id})">Terminer</button>`;
                else if(isAdmin) actionBtn = `<small>Assign√©: ${task.assignee}</small>`;
            }

            const card = document.createElement('div');
            card.className = 'quest-card';
            if(task.status === 'review') card.style.borderLeftColor = "var(--accent-cyan)";
            
            card.innerHTML = `
                <div><div style="font-weight:bold; font-size:1.1rem">${task.title}</div><div style="color:#aaa; font-size:0.9rem">${task.assignee} | <span style="color:var(--accent-gold)">${task.gold} $</span></div></div>
                <div style="text-align:right"><div style="font-size:0.7rem; text-transform:uppercase; color:${badgeColor}; font-weight:bold; margin-bottom:5px">${statusText}</div>${actionBtn}</div>`;
            list.appendChild(card);
        });
    }

    async function syncData() {
        await fetch(API_URL, { method:'POST', mode:'no-cors', headers:{'Content-Type':'application/json'}, body:JSON.stringify(appData) });
    }

    function addTask() {
        const title = document.getElementById('newTaskName').value;
        const assignee = document.getElementById('newTaskAssignee').value;
        const gold = parseInt(document.getElementById('newTaskGold').value);
        if(!title) return;
        appData.tasks.push({ id: Date.now(), title, assignee, gold, status: 'pending' });
        document.getElementById('newTaskName').value = "";
        renderDashboard(); syncData();
    }
    
    function completeTask(id) { 
        appData.tasks.find(t=>t.id===id).status = 'review'; 
        showSuccess("Good Boy !");
        renderDashboard(); syncData(); 
    }
    
    function approveTask(id) { 
        const t=appData.tasks.find(t=>t.id===id); t.status='done'; 
        if(appData.users[t.assignee]) { appData.users[t.assignee].gold+=t.gold; appData.users[t.assignee].xp+=t.gold; }
        showSuccess("CONFIRM√â !");
        renderDashboard(); syncData(); 
    }
    
    function buyItem(cost, item) {
        if(isAdmin) return alert("Les parents ne jouent pas !");
        const u = appData.users[currentUser];
        if(u.gold >= cost) {
            if(confirm(`Acheter ${item} ?`)) { u.gold -= cost; showSuccess("ACHAT R√âUSSI !"); renderDashboard(); syncData(); }
        } else alert("Pas assez d'or !");
    }

    function showSuccess(msg) {
        const popup = document.getElementById('successPopup');
        popup.innerHTML = `<h1>${msg}</h1>`;
        popup.style.display = 'block';
        try { confetti({ particleCount: 100, spread: 70, origin: { y: 0.6 } }); } catch(e){}
        setTimeout(() => { popup.style.display = 'none'; }, 2000);
    }

    function applyPreset() {
        const v = document.getElementById('taskPreset').value;
        if(v && PRESETS[v]) { document.getElementById('newTaskName').value = PRESETS[v].title; document.getElementById('newTaskGold').value = PRESETS[v].gold; }
    }

    init();
</script>
</body>
</html>
